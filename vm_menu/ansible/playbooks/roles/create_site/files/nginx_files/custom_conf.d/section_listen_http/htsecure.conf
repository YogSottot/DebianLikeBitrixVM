# Initialize variables
set $file_exists 0;
set $redirect_https 0;

# Check if .htsecure file exists
if (-f $document_root/.htsecure) {
    set $file_exists 1;
}

# Combine the two checks
if ($file_exists = 1) {
    set $redirect_check "${file_exists}${is_not_local}";
}

if ($redirect_check = "11") {
    set $redirect_https 1;
}

# Perform redirect if conditions are met
if ($redirect_https) {
    return 301 https://$host$request_uri;
}
